<?php include_once _include(APP_PATH."plugin/heizi_turnstile/utils/config.php");?>
<?php $config = getConfig(); ?>
<script>
    let checkElms=(obj)=>{let elm = obj.length>0 ? obj : obj.prevObject;return elm.length>0 ? elm : null}
    $(document).ready(()=>{
        let forms = checkElms($('form:not(:has(div.cf-turnstile),#search_form)'))
        if (!forms) return;

        //append script
        let script = document.createElement("script")
        script.src = "https://challenges.cloudflare.com/turnstile/v0/api.js"
        script.async = true
        script.defer = true

        $('body').append(script)

        let div = document.createElement("div")
        div.className+="cf-turnstile"
        div.attributes["data-sitekey"]="<?php echo $config[siteKey]?>"

        for (let self of forms) {
            let child = checkElms($(self).children("button,[type=submit,button]"))
            if (!child) $(child).before(div)
            else $(self).append(div)
        }
    })
</script>
